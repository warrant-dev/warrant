{
    "ignoredFields": [
        "createdAt",
        "id"
    ],
    "tests": [
        {
            "name": "listLastThreeResourceEvents",
            "request": {
                "method": "GET",
                "url": "/v1/resource-events?limit=3"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "faaee54a-e7a9-47ab-9c66-f21bc2ecef6f",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.657231Z"
                        },
                        {
                            "id": "d48522d7-dbad-480e-a862-c80185efffcf",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "role",
                            "resourceId": "senior-accountant",
                            "createdAt": "2023-09-06T16:31:53.65541Z"
                        },
                        {
                            "id": "6262d86c-01be-428c-acd8-434aaf969b32",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "permission",
                            "resourceId": "view-balance-sheet",
                            "createdAt": "2023-09-06T16:31:53.653927Z"
                        }
                    ],
                    "lastId": "{{ listLastThreeResourceEvents.lastId }}"
                }
            }
        },
        {
            "name": "listNextTwoResourceEvents",
            "request": {
                "method": "GET",
                "url": "/v1/resource-events?limit=2&lastId={{ listLastThreeResourceEvents.lastId }}"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "fec867c0-850e-4279-9a52-c5170184eb32",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "permission",
                            "resourceId": "balance-sheet:edit",
                            "createdAt": "2023-09-06T16:31:53.652344Z"
                        },
                        {
                            "id": "6cc2794f-ff47-4a0f-aa7b-6dedcec36ccc",
                            "type": "created",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.633353Z"
                        }
                    ],
                    "lastId": "{{ listNextTwoResourceEvents.lastId }}"
                }
            }
        },
        {
            "name": "listResourceEventsFilterBySource",
            "request": {
                "method": "GET",
                "url": "/v1/resource-events?limit=5&source=ui"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": []
                }
            }
        },
        {
            "name": "listResourceEventsFilterByType",
            "request": {
                "method": "GET",
                "url": "/v1/resource-events?limit=5&type=deleted"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "faaee54a-e7a9-47ab-9c66-f21bc2ecef6f",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.657231Z"
                        },
                        {
                            "id": "d48522d7-dbad-480e-a862-c80185efffcf",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "role",
                            "resourceId": "senior-accountant",
                            "createdAt": "2023-09-06T16:31:53.65541Z"
                        },
                        {
                            "id": "6262d86c-01be-428c-acd8-434aaf969b32",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "permission",
                            "resourceId": "view-balance-sheet",
                            "createdAt": "2023-09-06T16:31:53.653927Z"
                        },
                        {
                            "id": "fec867c0-850e-4279-9a52-c5170184eb32",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "permission",
                            "resourceId": "balance-sheet:edit",
                            "createdAt": "2023-09-06T16:31:53.652344Z"
                        },
                        {
                            "id": "289a30d1-aac0-4faf-8e30-94a2b3ca075c",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-6",
                            "createdAt": "2023-09-06T16:31:53.624389Z"
                        }
                    ],
                    "lastId": "{{ listResourceEventsFilterByType.lastId }}"
                }
            }
        },
        {
            "name": "listResourceEventsFilterByResourceType",
            "request": {
                "method": "GET",
                "url": "/v1/resource-events?limit=5&resourceType=user"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "faaee54a-e7a9-47ab-9c66-f21bc2ecef6f",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.657231Z"
                        },
                        {
                            "id": "6cc2794f-ff47-4a0f-aa7b-6dedcec36ccc",
                            "type": "created",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.633353Z"
                        },
                        {
                            "id": "77df7b79-41d4-4c00-abbe-bc7bb1e8c641",
                            "type": "created",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-b",
                            "createdAt": "2023-09-06T16:31:53.630605Z"
                        },
                        {
                            "id": "289a30d1-aac0-4faf-8e30-94a2b3ca075c",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-6",
                            "createdAt": "2023-09-06T16:31:53.624389Z"
                        },
                        {
                            "id": "ecf54d7a-5e98-4d7f-9cee-298cb4603076",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-5",
                            "meta": {
                                "email": ""
                            },
                            "createdAt": "2023-09-06T16:31:53.622972Z"
                        }
                    ],
                    "lastId": "{{ listResourceEventsFilterByResourceType.lastId }}"
                }
            }
        },
        {
            "name": "listResourceEventsFilterByResourceTypeAndResourceId",
            "request": {
                "method": "GET",
                "url": "/v1/resource-events?limit=3&resourceType=user&resourceId=user-a"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "faaee54a-e7a9-47ab-9c66-f21bc2ecef6f",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.657231Z"
                        },
                        {
                            "id": "6cc2794f-ff47-4a0f-aa7b-6dedcec36ccc",
                            "type": "created",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.633353Z"
                        },
                        {
                            "id": "20f3a76f-571f-4568-a693-a2ff7498025f",
                            "type": "deleted",
                            "source": "api",
                            "resourceType": "user",
                            "resourceId": "user-a",
                            "meta": {
                                "email": "user-a@warrant.dev"
                            },
                            "createdAt": "2023-09-06T16:31:53.277681Z"
                        }
                    ],
                    "lastId": "{{ listResourceEventsFilterByResourceTypeAndResourceId.lastId }}"
                }
            }
        },
        {
            "name": "listLastThreeAccessEvents",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=3"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "4770411b-031d-4e09-966c-7853229b39e2",
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "view-balance-sheet",
                            "relation": "member",
                            "subjectType": "role",
                            "subjectId": "senior-accountant",
                            "createdAt": "2023-09-06T16:31:53.650688Z"
                        },
                        {
                            "id": "bea7db3b-f3e7-497c-b755-f7242bf8ec07",
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "role",
                            "objectId": "senior-accountant",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "meta": {
                                "policy": "tenant == \"tenant-a\" \u0026\u0026 organization == \"org-a\""
                            },
                            "createdAt": "2023-09-06T16:31:53.649344Z"
                        },
                        {
                            "id": "878ae5c2-8bc4-40db-9db4-5d8e8a8a33cb",
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "balance-sheet:edit",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.646702Z"
                        }
                    ],
                    "lastId": "{{ listLastThreeAccessEvents.lastId }}"
                }
            }
        },
        {
            "name": "listNextTwoAccessEvents",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=2&lastId={{ listLastThreeAccessEvents.lastId }}"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "edc44ff1-d97a-4ab5-96e2-febdeab08cee",
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "view-balance-sheet",
                            "relation": "member",
                            "subjectType": "role",
                            "subjectId": "senior-accountant",
                            "createdAt": "2023-09-06T16:31:53.64342Z"
                        },
                        {
                            "id": "f37c97c7-6117-4366-9042-fa116f65c8de",
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "view-balance-sheet",
                            "relation": "member",
                            "subjectType": "role",
                            "subjectId": "senior-accountant",
                            "createdAt": "2023-09-06T16:31:53.641257Z"
                        }
                    ],
                    "lastId": "{{ listNextTwoAccessEvents.lastId }}"
                }
            }
        },
        {
            "name": "listAccessEventsFilterBySource",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=5&source=ui"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": []
                }
            }
        },
        {
            "name": "listAccessEventsFilterByType",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=4&type=access_granted"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "role",
                            "objectId": "senior-accountant",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "meta": {
                                "policy": "tenant == \"tenant-a\" \u0026\u0026 organization == \"org-a\""
                            }
                        },
                        {
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "balance-sheet:edit",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        },
                        {
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "view-balance-sheet",
                            "relation": "member",
                            "subjectType": "role",
                            "subjectId": "senior-accountant"
                        },
                        {
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "role",
                            "objectId": "senior-accountant",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "meta": {
                                "policy": "tenant == \"tenant-a\" \u0026\u0026 organization == \"org-a\""
                            }
                        }
                    ],
                    "lastId": "{{ listAccessEventsFilterByType.lastId }}"
                }
            }
        },
        {
            "name": "listAccessEventsFilterByObjectType",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=5&objectType=report"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        },
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor",
                            "subjectType": "role",
                            "subjectId": "admin",
                            "subjectRelation": "member"
                        },
                        {
                            "type": "access_allowed",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "non-owner",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        },
                        {
                            "type": "access_allowed",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor-viewer",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        },
                        {
                            "type": "access_allowed",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "viewer",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        }
                    ],
                    "lastId": "{{ listAccessEventsFilterByObjectType.lastId }}"
                }
            }
        },
        {
            "name": "listAccessEventsFilterByObjectTypeAndObjectId",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=5&objectType=report&objectId=report-a"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        },
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor",
                            "subjectType": "role",
                            "subjectId": "admin",
                            "subjectRelation": "member"
                        },
                        {
                            "type": "access_allowed",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "non-owner",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        },
                        {
                            "type": "access_allowed",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor-viewer",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        },
                        {
                            "type": "access_allowed",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "viewer",
                            "subjectType": "user",
                            "subjectId": "user-a"
                        }
                    ],
                    "lastId": "{{ listAccessEventsFilterByObjectTypeAndObjectId.lastId }}"
                }
            }
        },
        {
            "name": "listAccessEventsFilterByObjectTypeAndObjectIdAndRelation",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=5&objectType=report&objectId=report-a&relation=owner"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "owner",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "meta": {
                                "policy": "tenant == \"tenant-a\""
                            }
                        },
                        {
                            "type": "access_denied",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "owner",
                            "subjectType": "user",
                            "subjectId": "user-f",
                            "meta": {
                                "context": {
                                    "tenant": "tenant-b"
                                }
                            }
                        },
                        {
                            "type": "access_denied",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "owner",
                            "subjectType": "user",
                            "subjectId": "user-f",
                            "meta": {
                                "context": {
                                    "tenant": "tenant-a"
                                }
                            }
                        },
                        {
                            "type": "access_denied",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "owner",
                            "subjectType": "user",
                            "subjectId": "user-e",
                            "meta": {
                                "context": {
                                    "tenant": "tenant-b"
                                }
                            }
                        },
                        {
                            "type": "access_allowed",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "owner",
                            "subjectType": "user",
                            "subjectId": "user-e",
                            "meta": {
                                "context": {
                                    "tenant": "tenant-a"
                                }
                            }
                        }
                    ],
                    "lastId": "{{ listAccessEventsFilterByObjectTypeAndObjectIdAndRelation.lastId }}"
                }
            }
        },
        {
            "name": "listAccessEventsFilterBySubjectType",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=5&subjectType=user"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "id": "bea7db3b-f3e7-497c-b755-f7242bf8ec07",
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "role",
                            "objectId": "senior-accountant",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "meta": {
                                "policy": "tenant == \"tenant-a\" \u0026\u0026 organization == \"org-a\""
                            },
                            "createdAt": "2023-09-06T16:31:53.649344Z"
                        },
                        {
                            "id": "878ae5c2-8bc4-40db-9db4-5d8e8a8a33cb",
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "balance-sheet:edit",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "createdAt": "2023-09-06T16:31:53.646702Z"
                        },
                        {
                            "id": "d124af74-4ab5-44ed-86b4-585edab5df53",
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "permission",
                            "objectId": "balance-sheet:edit",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-b",
                            "createdAt": "2023-09-06T16:31:53.639968Z"
                        },
                        {
                            "id": "c2f57141-79fa-4893-8f4d-f5278ec7ce9e",
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "role",
                            "objectId": "senior-accountant",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "meta": {
                                "policy": "tenant == \"tenant-a\" \u0026\u0026 organization == \"org-a\""
                            },
                            "createdAt": "2023-09-06T16:31:53.63862Z"
                        },
                        {
                            "id": "4545d75b-0d97-448e-af47-88d8ff4a1a0a",
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "role",
                            "objectId": "senior-accountant",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-a",
                            "meta": {
                                "policy": "tenant == \"tenant-a\" \u0026\u0026 organization == \"org-a\""
                            },
                            "createdAt": "2023-09-06T16:31:53.634226Z"
                        }
                    ],
                    "lastId": "{{ listAccessEventsFilterBySubjectType.lastId }}"
                }
            }
        },
        {
            "name": "listAccessEventsFilterBySubjectTypeAndSubjectId",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=2&subjectType=user&subjectId=user-c"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "role",
                            "objectId": "admin-a",
                            "relation": "member",
                            "subjectType": "user",
                            "subjectId": "user-c",
                            "meta": {
                                "policy": "tenant == \"tenant-a\""
                            }
                        },
                        {
                            "type": "access_denied",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-b",
                            "relation": "owner",
                            "subjectType": "user",
                            "subjectId": "user-c",
                            "meta": {
                                "context": {
                                    "tenant": "tenant-b"
                                }
                            }
                        }
                    ],
                    "lastId": "{{ listAccessEventsFilterBySubjectTypeAndSubjectId.lastId }}"
                }
            }
        },
        {
            "name": "listAccessEventsFilterBySubjectTypeAndSubjectRelation",
            "request": {
                "method": "GET",
                "url": "/v1/access-events?limit=4&subjectType=role&subjectRelation=member"
            },
            "expectedResponse": {
                "statusCode": 200,
                "body": {
                    "events": [
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor",
                            "subjectType": "role",
                            "subjectId": "admin",
                            "subjectRelation": "member"
                        },
                        {
                            "type": "access_granted",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "report-a",
                            "relation": "editor",
                            "subjectType": "role",
                            "subjectId": "admin",
                            "subjectRelation": "member"
                        },
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "*",
                            "relation": "owner",
                            "subjectType": "role",
                            "subjectId": "admin-a",
                            "subjectRelation": "member",
                            "meta": {
                                "policy": "tenant == \"tenant-a\""
                            }
                        },
                        {
                            "type": "access_revoked",
                            "source": "api",
                            "objectType": "report",
                            "objectId": "*",
                            "relation": "owner",
                            "subjectType": "role",
                            "subjectId": "admin-b",
                            "subjectRelation": "member",
                            "meta": {
                                "policy": "tenant == \"tenant-b\""
                            }
                        }
                    ],
                    "lastId": "{{ listAccessEventsFilterBySubjectTypeAndSubjectRelation.lastId }}"
                }
            }
        }
    ]
}
